<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroQuant Agents</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'JetBrains Mono', monospace;
        }
        
        body {
            background: #000;
            min-height: 100vh;
            color: #fff;
        }
        
        .mono-card {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            transition: all 0.2s ease;
        }
        
        .mono-card:hover {
            border-color: #333;
        }
        
        .btn-mono {
            background: #fff;
            color: #000;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .btn-mono:hover {
            background: #000;
            color: #fff;
            border: 1px solid #fff;
        }
        
        .profit {
            color: #00ff00;
        }
        
        .loss {
            color: #ff0000;
        }
        
        .border-accent {
            border-color: #1a1a1a;
        }
        
        .border-accent:hover {
            border-color: #333;
        }
        
        input, select, textarea {
            transition: all 0.2s ease;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            color: #fff;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #333;
            outline: none;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border: 1px solid #333;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>
    <div class="min-h-screen text-gray-100">
        <!-- Header -->
        <div id="header-container"></div>

        <div class="container mx-auto px-4 py-8">
            <h2 class="text-4xl font-light mb-8 tracking-wide">AGENT MANAGEMENT</h2>
            
            <!-- Create Agent Section -->
            <section class="mb-8">
                <div class="mono-card rounded-none p-6 border">
                    <h3 class="text-xl font-light mb-6 uppercase tracking-wide">
                        Create New Agent
                    </h3>
                    <form id="createAgentForm" class="space-y-5">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-sm font-light text-gray-300 mb-2 uppercase tracking-wide">Agent Name</label>
                                <input type="text" id="agentName" 
                                    class="w-full px-4 py-3 rounded-none border focus:outline-none" 
                                    placeholder="My DQN Agent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-light text-gray-300 mb-2 uppercase tracking-wide">Agent Type</label>
                                <select id="agentType" class="w-full px-4 py-3 rounded-none border focus:outline-none" required>
                                    <option value="DQN">DQN (Deep Q-Network)</option>
                                    <option value="PPO">PPO (Proximal Policy Optimization)</option>
                                    <option value="IndicatorBased">Indicator Based</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-light text-gray-300 mb-2 uppercase tracking-wide">Parameters (JSON)</label>
                            <textarea id="agentParameters" rows="4" 
                                class="w-full px-4 py-3 rounded-none border focus:outline-none text-sm" 
                                placeholder='{"learning_rate": 0.001, "gamma": 0.99, "batch_size": 64}'></textarea>
                            <p class="text-xs text-gray-500 mt-1">Optional: Provide custom parameters in JSON format</p>
                        </div>
                        <button type="submit" class="btn-mono font-light py-3 px-8 rounded-none uppercase tracking-wide">
                            Create Agent
                        </button>
                        <div id="createAgentMessage" class="mt-4 profit hidden"></div>
                        <div id="createAgentError" class="mt-4 loss hidden"></div>
                    </form>
                </div>
            </section>

            <!-- Existing Agents Section -->
            <section>
                <div class="mono-card rounded-none p-6 border">
                    <h3 class="text-xl font-light mb-6 uppercase tracking-wide">
                        Existing Agents
                    </h3>
                    <div id="agentList" class="space-y-4">
                        <p class="text-gray-400 text-center py-8">Loading agents...</p>
                    </div>
                    <div id="agentListError" class="mt-4 loss hidden"></div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <div id="footer-container"></div>
    </div>
    <script src="components.js"></script>
    <script>
        NeuroQuantComponents.init('agents');
    </script>
    <script>
        const BACKEND_URL = 'http://localhost:8000'; // Assuming backend runs on this URL

        document.addEventListener('DOMContentLoaded', () => {
            loadAgents();
            document.getElementById('createAgentForm').addEventListener('submit', createAgent);
        });

        async function loadAgents() {
            const agentListDiv = document.getElementById('agentList');
            const agentListError = document.getElementById('agentListError');
            agentListDiv.innerHTML = '<p class="text-gray-400 text-center py-8">Loading agents...</p>';
            agentListError.classList.add('hidden');

            try {
                const response = await fetch(`${BACKEND_URL}/agents`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const agents = await response.json();
                
                agentListDiv.innerHTML = '';

                if (agents.length === 0) {
                    agentListDiv.innerHTML = `
                        <div class="text-center py-12">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            <p class="text-gray-400">No agents created yet. Create your first agent above!</p>
                        </div>
                    `;
                    return;
                }

                agents.forEach(agent => {
                    const agentDiv = document.createElement('div');
                    agentDiv.className = 'mono-card p-5 rounded-none border border-accent hover:border-white transition-all';
                    agentDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h4 class="text-lg font-light text-white mb-1 uppercase tracking-wide">${agent.name}</h4>
                                <span class="badge">${agent.type}</span>
                            </div>
                            <span class="text-xs text-gray-500 px-3 py-1 border border-gray-800">ID: ${agent.id}</span>
                        </div>
                        <div class="mt-3 p-3 bg-black border border-gray-800">
                            <p class="text-xs text-gray-400 mb-1 uppercase tracking-wide">Parameters:</p>
                            <pre class="text-xs text-gray-300 overflow-x-auto">${JSON.stringify(agent.parameters, null, 2)}</pre>
                        </div>
                    `;
                    agentListDiv.appendChild(agentDiv);
                });

            } catch (error) {
                console.error('Error loading agents:', error);
                agentListDiv.innerHTML = '';
                agentListError.textContent = `Failed to load agents: ${error.message}`;
                agentListError.classList.remove('hidden');
            }
        }

        async function createAgent(event) {
            event.preventDefault();

            const agentName = document.getElementById('agentName').value;
            const agentType = document.getElementById('agentType').value;
            let agentParameters = document.getElementById('agentParameters').value;

            const createAgentMessage = document.getElementById('createAgentMessage');
            const createAgentError = document.getElementById('createAgentError');
            createAgentMessage.classList.add('hidden');
            createAgentError.classList.add('hidden');

            try {
                // Attempt to parse parameters as JSON
                let parsedParameters = {};
                if (agentParameters.trim() !== '') {
                    parsedParameters = JSON.parse(agentParameters);
                }

                const response = await fetch(`${BACKEND_URL}/agents`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        name: agentName, 
                        type: agentType, 
                        parameters: parsedParameters 
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
                }

                const newAgent = await response.json();
                createAgentMessage.textContent = `Agent '${newAgent.name}' created successfully!`;
                createAgentMessage.classList.remove('hidden');

                // Clear form
                document.getElementById('createAgentForm').reset();
                document.getElementById('agentParameters').value = ''; // Ensure textarea is cleared

                loadAgents(); // Reload agent list

            } catch (error) {
                console.error('Error creating agent:', error);
                createAgentError.textContent = `Failed to create agent: ${error.message}`;
                createAgentError.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>